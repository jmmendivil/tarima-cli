#!/usr/bin/env node

var start = new Date();

var run = require('./'),
    path = require('path'),
    minimist = require('minimist');

var $ = require('./utils');

var pwd = process.cwd(),
    pkg = path.join(pwd, 'package.json');

var argv = minimist(process.argv.slice(2));

var fixedSrc = argv.src || argv._[0] || 'src',
    fixedDest = argv.dest || argv._[1] || 'build';

var defaultConfig = {
  src: path.join(pwd, fixedSrc),
  dest: path.join(pwd, fixedDest, 'dist'),
  cache: path.join(pwd, fixedDest, 'index.json'),
  watch: argv.watch
};

if ($.isFile(pkg)) {
  defaultConfig = $.merge(defaultConfig, $.readJSON(pkg).tarima || {});
}

run(defaultConfig, function(err, result) {
  if (err) {
    console.log($.style('{red|%s}', err.stack || err));
  }

  console.log($.style('{cyan|%s file(s) synced in %s}', result.files.length, $.timeDiff(start)));
});
